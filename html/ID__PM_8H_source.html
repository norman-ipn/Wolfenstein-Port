<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Wolfenstein Port: ID_PM.H Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Wolfenstein Port&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">Port of the game Wolfenstein 3D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">ID_PM.H</div>  </div>
</div>
<div class="contents">
<a href="ID__PM_8H.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">//      ID_PM.H</span>
<a name="l00003"></a>00003 <span class="comment">//      Header file for Id Engine&#39;s Page Manager</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">//      NOTE! PMPageSize must be an even divisor of EMSPageSize, and &gt;= 1024</span>
<a name="l00007"></a><a class="code" href="ID__PM_8H.html#a856b167f452e867314b42dde91dd1984">00007</a> <span class="preprocessor">#define EMSPageSize             16384</span>
<a name="l00008"></a><a class="code" href="ID__PM_8H.html#a30071d9742e4792a5cea0c8d787a27a9">00008</a> <span class="preprocessor"></span><span class="preprocessor">#define EMSPageSizeSeg  (EMSPageSize &gt;&gt; 4)</span>
<a name="l00009"></a><a class="code" href="ID__PM_8H.html#a3c0e4d41b64141a953315eda7ef6bf7c">00009</a> <span class="preprocessor"></span><span class="preprocessor">#define EMSPageSizeKB   (EMSPageSize &gt;&gt; 10)</span>
<a name="l00010"></a><a class="code" href="ID__PM_8H.html#afffc419fcd53fc6a4f50bd6d9854bd1d">00010</a> <span class="preprocessor"></span><span class="preprocessor">#define EMSFrameCount   4</span>
<a name="l00011"></a><a class="code" href="ID__PM_8H.html#a5e4c70ba1e278d1d2fb9cec2b0fecadb">00011</a> <span class="preprocessor"></span><span class="preprocessor">#define PMPageSize              4096</span>
<a name="l00012"></a><a class="code" href="ID__PM_8H.html#a7d4ab7bf0b85e8db8ee6ceccacb16e39">00012</a> <span class="preprocessor"></span><span class="preprocessor">#define PMPageSizeSeg   (PMPageSize &gt;&gt; 4)</span>
<a name="l00013"></a><a class="code" href="ID__PM_8H.html#aca70fe2da2793734afbb08715dd5d545">00013</a> <span class="preprocessor"></span><span class="preprocessor">#define PMPageSizeKB    (PMPageSize &gt;&gt; 10)</span>
<a name="l00014"></a><a class="code" href="ID__PM_8H.html#a9f2f9b21608730589c4e27d6aa584959">00014</a> <span class="preprocessor"></span><span class="preprocessor">#define PMEMSSubPage    (EMSPageSize / PMPageSize)</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a><a class="code" href="ID__PM_8H.html#a5a6fe12b7cbcef7f1fb3c798f3265db5">00016</a> <span class="preprocessor">#define PMMinMainMem    10                      // Min acceptable # of pages from main</span>
<a name="l00017"></a><a class="code" href="ID__PM_8H.html#a82525b0875c0007597f80f287b853d05">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define PMMaxMainMem    100                     // Max number of pages in main memory</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a><a class="code" href="ID__PM_8H.html#a7340787578cedc2eff541f5ce36699ac">00019</a> <span class="preprocessor">#define PMThrashThreshold       1       // Number of page thrashes before panic mode</span>
<a name="l00020"></a><a class="code" href="ID__PM_8H.html#ace1e6a95fd1690cf5163da52e8334dbf">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define PMUnThrashThreshold     5       // Number of non-thrashing frames before leaving panic mode</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a><a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851">00022</a> <span class="keyword">typedef</span> <span class="keyword">enum</span>
<a name="l00023"></a>00023                 {
<a name="l00024"></a><a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851ad7573300e04abc96d2c781318ab78f1a">00024</a>                         <a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851ad7573300e04abc96d2c781318ab78f1a">pml_Unlocked</a>,
<a name="l00025"></a><a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851a7efa3ea64a5cae5233dd638ca11b35d6">00025</a>                         <a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851a7efa3ea64a5cae5233dd638ca11b35d6">pml_Locked</a>
<a name="l00026"></a>00026                 } <a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851">PMLockType</a>;
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5b">00028</a> <span class="keyword">typedef</span> <span class="keyword">enum</span>
<a name="l00029"></a>00029                 {
<a name="l00030"></a><a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5ba439b0558ad54d83b7cca487607714a76">00030</a>                         <a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5ba439b0558ad54d83b7cca487607714a76">pmba_Unused</a> = 0,
<a name="l00031"></a><a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5ba99ecca1f78b2189c74695a5171796a07">00031</a>                         <a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5ba99ecca1f78b2189c74695a5171796a07">pmba_Used</a> = 1,
<a name="l00032"></a><a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5ba807fb1ba068480551947952c5dd1c14c">00032</a>                         <a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5ba807fb1ba068480551947952c5dd1c14c">pmba_Allocated</a> = 2
<a name="l00033"></a>00033                 } <a class="code" href="ID__PM_8H.html#a061921eacd832e8d25698aed67818b5b">PMBlockAttr</a>;
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="structPageListStruct.html">00035</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00036"></a>00036                 {
<a name="l00037"></a><a class="code" href="structPageListStruct.html#a9b67eab88331155941372df93f50b643">00037</a>                         <a class="code" href="ID__HEAD_8H.html#a8a9a7dd50c6fdb45dcdf0eb929479663">longword</a>        <a class="code" href="structPageListStruct.html#a9b67eab88331155941372df93f50b643">offset</a>;         <span class="comment">// Offset of chunk into file</span>
<a name="l00038"></a><a class="code" href="structPageListStruct.html#a77f59888a56d0d4592acd4e1a80c9883">00038</a>                         <a class="code" href="ID__HEAD_8H.html#abad51e07ab6d26bec9f1f786c8d65bcd">word</a>            <a class="code" href="structPageListStruct.html#a77f59888a56d0d4592acd4e1a80c9883">length</a>;         <span class="comment">// Length of the chunk</span>
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="structPageListStruct.html#a57b442a1b1e2e08e5607930e36697d24">00040</a>                         <span class="keywordtype">int</span>                     <a class="code" href="structPageListStruct.html#a57b442a1b1e2e08e5607930e36697d24">xmsPage</a>;        <span class="comment">// If in XMS, (xmsPage * PMPageSize) gives offset into XMS handle</span>
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="structPageListStruct.html#abf25d4d4feab9130ea49d1dbdf485673">00042</a>                         <a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851">PMLockType</a>      <a class="code" href="structPageListStruct.html#abf25d4d4feab9130ea49d1dbdf485673">locked</a>;         <span class="comment">// If set, this page can&#39;t be purged</span>
<a name="l00043"></a><a class="code" href="structPageListStruct.html#a0b6ebc3ddfc14d5c510a5e93fb3d59ff">00043</a>                         <span class="keywordtype">int</span>                     <a class="code" href="structPageListStruct.html#a0b6ebc3ddfc14d5c510a5e93fb3d59ff">emsPage</a>;        <span class="comment">// If in EMS, logical page/offset into page</span>
<a name="l00044"></a><a class="code" href="structPageListStruct.html#a64f05551b9c34348c49f4a175b9e4072">00044</a>                         <span class="keywordtype">int</span>                     <a class="code" href="structPageListStruct.html#a64f05551b9c34348c49f4a175b9e4072">mainPage</a>;       <span class="comment">// If in Main, index into handle array</span>
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="structPageListStruct.html#a9097befea1b690bf042b0dc216ecba94">00046</a>                         <a class="code" href="ID__HEAD_8H.html#a8a9a7dd50c6fdb45dcdf0eb929479663">longword</a>        <a class="code" href="structPageListStruct.html#a9097befea1b690bf042b0dc216ecba94">lastHit</a>;        <span class="comment">// Last frame number of hit</span>
<a name="l00047"></a>00047                 } <a class="code" href="structPageListStruct.html">PageListStruct</a>;
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="structEMSListStruct.html">00049</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00050"></a>00050                 {
<a name="l00051"></a><a class="code" href="structEMSListStruct.html#a796d43f51115ed7425008ab343d295be">00051</a>                         <span class="keywordtype">int</span>                     <a class="code" href="structEMSListStruct.html#a796d43f51115ed7425008ab343d295be">baseEMSPage</a>;    <span class="comment">// Base EMS page for this phys frame</span>
<a name="l00052"></a><a class="code" href="structEMSListStruct.html#a4b5befaa05458fe981ab122c0d496b00">00052</a>                         <a class="code" href="ID__HEAD_8H.html#a8a9a7dd50c6fdb45dcdf0eb929479663">longword</a>        <a class="code" href="structEMSListStruct.html#a4b5befaa05458fe981ab122c0d496b00">lastHit</a>;                <span class="comment">// Last frame number of hit</span>
<a name="l00053"></a>00053                 } <a class="code" href="structEMSListStruct.html">EMSListStruct</a>;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="keyword">extern</span>  <span class="keywordtype">boolean</span>                 <a class="code" href="ID__PM_8C.html#a5f57a31d9e6a665cbebbb452d757de61">XMSPresent</a>,<a class="code" href="ID__PM_8C.html#ab35be0811b0150bb1a52eaad6d3d6340">EMSPresent</a>;
<a name="l00056"></a>00056 <span class="keyword">extern</span>  <a class="code" href="ID__HEAD_8H.html#abad51e07ab6d26bec9f1f786c8d65bcd">word</a>                    <a class="code" href="ID__PM_8C.html#ac00fcb63e290e188116ecc3f43ec3f93">XMSPagesAvail</a>,<a class="code" href="ID__PM_8C.html#a0b3caaa008ec8ab4b8486880a825bad0">EMSPagesAvail</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keyword">extern</span>  <a class="code" href="ID__HEAD_8H.html#abad51e07ab6d26bec9f1f786c8d65bcd">word</a>                    <a class="code" href="ID__PM_8C.html#af385634b054d3e3d81d85865b3d7e71e">ChunksInFile</a>,
<a name="l00059"></a>00059                                                 <a class="code" href="ID__PM_8C.html#ac15156742487c3e546be66ffc29b4473">PMSpriteStart</a>,<a class="code" href="ID__PM_8C.html#a4274c51cf3dd5e7fd0c4562376e91d3b">PMSoundStart</a>;
<a name="l00060"></a>00060 <span class="keyword">extern</span>  <a class="code" href="structPageListStruct.html">PageListStruct</a>  far *<a class="code" href="ID__PM_8C.html#aac6e5bfd3ae3497c8b721679578d73f1">PMPages</a>;
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="ID__PM_8H.html#a01b9735ae9bc9f8601a2dca0e4b6faf3">00062</a> <span class="preprocessor">#define PM_GetSoundPage(v)      PM_GetPage(PMSoundStart + (v))</span>
<a name="l00063"></a><a class="code" href="ID__PM_8H.html#ae0fd66bb8ceae9630194a465a8fc2acd">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define PM_GetSpritePage(v)     PM_GetPage(PMSpriteStart + (v))</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="ID__PM_8H.html#a1b8d94c3a62d20f392ed7aab4a593342">00065</a> <span class="preprocessor">#define PM_LockMainMem()        PM_SetMainMemPurge(0)</span>
<a name="l00066"></a><a class="code" href="ID__PM_8H.html#acd7ffa4f7a2767e6707daa821671e46b">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define PM_UnlockMainMem()      PM_SetMainMemPurge(3)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">extern</span>  <span class="keywordtype">char</span>    <a class="code" href="ID__PM_8C.html#a3d2a1c78f3a8c484f8b2ed0cbe566453">PageFileName</a>[13];
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="keyword">extern</span>  <span class="keywordtype">void</span>    <a class="code" href="ID__PM_8C.html#a5e5ef876a9184793502a2a5b6884e2d0">PM_Startup</a>(<span class="keywordtype">void</span>),
<a name="l00073"></a>00073                                 <a class="code" href="ID__PM_8C.html#a4c8f2bd44f288cb9d7d9c4abe52ffa8c">PM_Shutdown</a>(<span class="keywordtype">void</span>),
<a name="l00074"></a>00074                                 <a class="code" href="ID__PM_8C.html#a25eb3f2f08365f6707cb60a298b2366e">PM_Reset</a>(<span class="keywordtype">void</span>),
<a name="l00075"></a>00075                                 <a class="code" href="ID__PM_8C.html#ab97049dc4c67f252768239ca432f4204">PM_Preload</a>(<span class="keywordtype">boolean</span> (*<a class="code" href="ID__VH_8C.html#afbdf4a0314978cdee83ec9193c21bba9">update</a>)(<a class="code" href="ID__HEAD_8H.html#abad51e07ab6d26bec9f1f786c8d65bcd">word</a> current,<a class="code" href="ID__HEAD_8H.html#abad51e07ab6d26bec9f1f786c8d65bcd">word</a> total)),
<a name="l00076"></a>00076                                 <a class="code" href="ID__PM_8C.html#a18e14139add000a914aa1c385ad33f34">PM_NextFrame</a>(<span class="keywordtype">void</span>),
<a name="l00077"></a>00077                                 <a class="code" href="ID__PM_8C.html#a1e7da5d85fc01341f8f9a893ddc87cfc">PM_SetPageLock</a>(<span class="keywordtype">int</span> <a class="code" href="WL__TEXT_8C.html#ad303d1f16fd753775f930d896512b75b">pagenum</a>,<a class="code" href="ID__PM_8H.html#a470960f2645467be319a542ef1f65851">PMLockType</a> lock),
<a name="l00078"></a>00078                                 <a class="code" href="ID__PM_8H.html#aaf911d3a6de179ab5a3bc27e9d263a99">PM_SetMainPurge</a>(<span class="keywordtype">int</span> level),
<a name="l00079"></a>00079                                 <a class="code" href="ID__PM_8C.html#a2a4e1e1198255c4890972680f9fb5a15">PM_CheckMainMem</a>(<span class="keywordtype">void</span>);
<a name="l00080"></a>00080 <span class="keyword">extern</span>  <a class="code" href="ID__MM_8H.html#a04062decc7eb282b066c65e9137bb9bf">memptr</a>  <a class="code" href="ID__PM_8C.html#a6d8376b84fdfd88c991b82d9d9cebcfd">PM_GetPageAddress</a>(<span class="keywordtype">int</span> <a class="code" href="WL__TEXT_8C.html#ad303d1f16fd753775f930d896512b75b">pagenum</a>),
<a name="l00081"></a>00081                                 <a class="code" href="ID__PM_8C.html#a80f33d5bd3e0a9a388063a78edf53329">PM_GetPage</a>(<span class="keywordtype">int</span> <a class="code" href="WL__TEXT_8C.html#ad303d1f16fd753775f930d896512b75b">pagenum</a>);                <span class="comment">// Use this one to cache page</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="keywordtype">void</span> <a class="code" href="ID__PM_8C.html#a5182c3fcfa8dd2f64fa5e9b8254dc991">PM_SetMainMemPurge</a>(<span class="keywordtype">int</span> level);
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Oct 10 2012 for Wolfenstein Port by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
